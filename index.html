<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' https://www.gstatic.com; connect-src 'self' https://firestore.googleapis.com https://*.googleapis.com https://*.firebaseio.com; style-src 'self'; img-src 'self' data:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'"
    />
    <meta name="referrer" content="no-referrer" />
    <title>Leave a Message // OTP Terminal</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="scanline" aria-hidden="true"></div>
    <main class="terminal">
      <header class="terminal__header">
        <p class="terminal__prompt">root@otp-node:~$ ./leave-a-message</p>
        <h1>One-Time Pad Message Vault</h1>
        <p class="terminal__note">
          Keys are never stored. Decryption happens only in your browser.
        </p>
      </header>

      <section class="tabs" aria-label="Application sections">
        <button class="tab is-active" data-tab="create">Leave Message</button>
        <button class="tab" data-tab="find">Find &amp; Decipher</button>
      </section>

      <section class="panel is-active" id="panel-create">
        <form id="create-form" autocomplete="off">
          <label>
            Inbox Name
            <input name="inbox" required maxlength="80" placeholder="e.g. operation-neon" />
          </label>

          <label>
            Open Text (stored as-is, optional)
            <textarea
              name="openText"
              rows="3"
              placeholder="Visible fallback message"
            ></textarea>
          </label>

          <label>
            Text to Encrypt
            <textarea
              name="secretText"
              required
              rows="3"
              placeholder="Encrypted with one-time pad"
            ></textarea>
          </label>

          <label>
            OTP Key (must be at least secret text length)
            <textarea
              name="key"
              required
              rows="3"
              placeholder="Paste or generate a key"
            ></textarea>
          </label>

          <div class="actions">
            <button type="button" id="generate-key">Generate Random Key</button>
            <button type="submit">Encrypt &amp; Save Message to Inbox</button>
          </div>

          <p id="key-warning" class="warning" hidden>
            Generated key is shown once. Save it now â€” without it, deciphering is impossible.
          </p>

          <p id="create-status" class="status" role="status" aria-live="polite"></p>
        </form>
      </section>

      <section class="panel" id="panel-find">
        <form id="search-form" autocomplete="off">
          <label>
            Inbox Name
            <input name="searchInbox" required maxlength="80" placeholder="Find by inbox name" />
          </label>
          <button type="submit" id="load-inbox">Load Inbox</button>
        </form>

        <article id="search-results" class="result" hidden>
          <h2>Inbox Messages</h2>
          <p>Select a message to view and decipher it:</p>
          <ul id="result-list" class="message-list"></ul>
        </article>

        <article id="result" class="result" hidden>
          <h2>Selected Message</h2>
          <p><strong>Open Text:</strong> <span id="result-open"></span></p>
          <p><strong id="result-text-label">Encrypted Text:</strong> <code id="result-encrypted"></code></p>

          <form id="decipher-form" autocomplete="off">
            <label>
              OTP Key for Deciphering
              <textarea
                name="decipherKey"
                required
                rows="3"
                placeholder="Enter the original key (or longer)"
              ></textarea>
            </label>
            <button type="submit">Decipher</button>
          </form>
        </article>

        <p id="search-status" class="status" role="status" aria-live="polite"></p>
        <p id="decipher-status" class="status" role="status" aria-live="polite"></p>
      </section>
    </main>

    <script src="firebase-config.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
